<template>
    <div class="soql-container">
        <h2>SOQL Builder</h2>
        <p>Build your query interactively from Salesforce objects.</p>

        <!-- Object selector -->
        <lightning-combobox
            label="Select Object"
            value={selectedObject}
            placeholder="Choose an object"
            options={objectOptions}
            onchange={handleObjectChange}>
        </lightning-combobox>

        <!-- Field selector -->
        <template if:true={fieldOptions.length}>
            <lightning-dual-listbox
                label="Select Fields"
                source-label="Available"
                selected-label="Selected"
                options={fieldOptions}
                value={selectedFields}
                onchange={handleFieldsChange}>
            </lightning-dual-listbox>
        </template>

        <!-- Optional WHERE clause -->
        <lightning-input
            label="WHERE Condition (optional)"
            placeholder="Example: Name LIKE 'A%'"
            value={whereCondition}
            onchange={handleWhereChange}>
        </lightning-input>

        <!-- Generated SOQL preview -->
        <div class="query-preview">
            <h3>Generated SOQL</h3>
            <pre>{generatedQuery}</pre>
        </div>

        <!-- Run query button -->
        <lightning-button 
            variant="brand" 
            label={runButtonLabel} 
            onclick={handleRun} 
            disabled={isLoading}>
        </lightning-button>

        <!-- Spinner overlay -->
        <template if:true={isLoading}>
            <div class="spinner-overlay">
                <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
            </div>
        </template>

        <!-- Query results -->
        <template if:true={hasResults}>
            <div class="results-table">
                <lightning-datatable
                    key-field="Id"
                    data={queryResults}
                    columns={columns}
                    hide-checkbox-column="true">
                </lightning-datatable>
            </div>
        </template>
    </div>
</template>
