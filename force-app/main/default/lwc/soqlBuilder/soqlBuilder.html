<template>
  <div class="soql-container">
    <h2>SOQL Builder</h2>
    <p>Build your query interactively from Salesforce objects.</p>

    <!-- Object selector -->
    <lightning-combobox
      label="Select Object"
      value={selectedObject}
      placeholder="Choose an object"
      options={objectOptions}
      onchange={handleObjectChange}>
    </lightning-combobox>

    <!-- Field selector -->
    <template if:true={fieldOptions.length}>
      <lightning-dual-listbox
        class="m-top"
        label="Select Fields"
        source-label="Available"
        selected-label="Selected"
        options={fieldOptions}
        value={selectedFields}
        onchange={handleFieldsChange}>
      </lightning-dual-listbox>
    </template>

    <!-- WHERE clause -->
    <lightning-input
      class="m-top"
      label="WHERE Condition (optional)"
      placeholder="Example: Name LIKE 'A%'"
      value={whereCondition}
      onchange={handleWhereChange}>
    </lightning-input>

    <!-- Sorting & limits row -->
    <div class="grid m-top">
      <lightning-combobox
        label="ORDER BY Field"
        value={orderByField}
        placeholder="None"
        options={orderByFieldOptions}
        onchange={handleOrderByChange}>
      </lightning-combobox>

      <lightning-combobox
        label="Direction"
        value={orderDirection}
        options={directionOptions}
        onchange={handleDirectionChange}>
      </lightning-combobox>

      <lightning-combobox
        label="NULLS"
        value={nullsBehavior}
        options={nullsOptions}
        onchange={handleNullsChange}>
      </lightning-combobox>

      <lightning-input
        type="number"
        label="LIMIT"
        value={limitRows}
        min="1"
        max="2000"
        onchange={handleLimitChange}>
      </lightning-input>

      <lightning-input
        type="number"
        label="OFFSET"
        value={offsetRows}
        min="0"
        max="2000"
        onchange={handleOffsetChange}>
      </lightning-input>
    </div>

    <!-- Generated SOQL preview -->
    <div class="query-preview m-top">
      <h3>Generated SOQL</h3>
      <pre>{generatedQuery}</pre>
    </div>

    <!-- Actions -->
    <div class="actions">
      <lightning-button
        variant="brand"
        label={runButtonLabel}
        onclick={handleRun}
        disabled={isLoading}>
      </lightning-button>
    </div>

    <!-- Loading overlay -->
    <template if:true={isLoading}>
      <div class="spinner-overlay">
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
      </div>
    </template>

    <!-- Results -->
    <template if:true={hasResults}>
      <section class="results-table m-top">
        <div class="table-scroll slds-scrollable_y">
          <lightning-datatable
            key-field="Id"
            data={queryResults}
            columns={columns}
            hide-checkbox-column="true">
          </lightning-datatable>
        </div>
      </section>
    </template>
  </div>
</template>
